# InterrogateText2Xlsx v3.0 - 文件内容反推工具

## 简介
InterrogateText2Xlsx 是一个Python脚本，旨在帮助用户扫描指定文件夹及其子文件夹中的各类文件，并尝试查找与之同名的 `.txt` 文件。如果找到 `.txt` 文件，它将提取其内容，进行清洗，并识别出特定的提示词类型（如R18、boy、no_human、黑白原图等）。所有扫描结果（包括匹配到的文件及其对应的TXT内容，以及未匹配到TXT的文件）都会被整理并保存到结构化的Excel文件中，同时生成详细的运行日志。此外，程序还会维护一份历史扫描记录，方便用户追溯，并新增了对扫描到的所有Tag词频的统计功能。

## 主要功能

### 1. 文件扫描与TXT匹配
- **深度扫描**: 程序会递归遍历用户指定文件夹下的所有文件（包括子文件夹）。
- **智能匹配**: 对于非 `.txt` 文件，程序会尝试查找其同名的 `.txt` 文件（例如 `image.jpg` 会尝试匹配 `image.txt`）。
- **多文件类型支持**: 不仅仅局限于图片文件，程序会扫描所有非 `.txt` 文件类型。

### 2. TXT内容处理
- **内容提取**: 成功匹配的 `.txt` 文件内容会被提取。
- **数据清洗**: 对提取出的内容进行清洗，自动移除包含“censor”和“monochrome”的标签，并对含有特定敏感词（如 `nipple`, `pussy`, `penis`, `hetero`, `sex`, `anus` 等更多R18相关词汇）的内容自动追加“uncensored”标签，以方便管理和识别。
- **提示词类型检测**: 根据 `.txt` 内容自动检测并标记出提示词的类型，目前支持：
    - `R18`: 包含大量敏感词汇（详见代码）。
    - `boy`: 包含 `1boy`, `2boys`, `multiple_boys` 等词汇。
    - `no_human`: 包含 `no_human` 词汇。
    - `黑白原图`: **新增**，包含 `monochrome` 词汇。

### 3. 结果输出与管理
- **Excel报告**:
    - **“已匹配TXT文件”工作表**: 记录所有成功匹配到 `.txt` 文件的信息，包括：
        - 文件夹绝对路径
        - 文件绝对路径
        - 文件超链接 (可直接点击打开文件)
        - 文件后缀
        - TXT绝对路径
        - TXT内容（原始）
        - 清洗后的数据
        - 提示词类型
        - 是否找到匹配TXT (显示“是”)
    - **“未匹配TXT文件”工作表**: 记录所有未找到或读取 `.txt` 文件失败的文件信息，包括：
        - 文件夹绝对路径
        - 文件绝对路径
        - 文件超链接 (可直接点击打开文件)
        - 文件后缀
        - 是否找到匹配TXT (显示“否”或“否 (读取错误)”)
    - **“Tag 词频统计”工作表**: **新增**，统计所有清洗后的Tag及其在整个扫描过程中出现的次数，并按出现次数降序排列，包括：
        - Tag
        - 出现次数
- **日志文件**: 生成详细的 `scan_log_YYYYMMDD_HHMMSS.txt` 日志文件，记录程序运行过程中的重要信息和遇到的错误。

### 4. 文件保存策略
- **多位置保存**:
    - **主保存位置**: 所有结果文件（Excel报告和日志）优先保存到Python脚本所在目录下的“反推历史记录”子文件夹中。
    - **次要保存位置**: 同时，一份副本会保存到用户指定处理文件夹下的“反推记录”子文件夹中（如果该文件夹不存在，程序会自动创建）。
- **文件名带时间戳**: 生成的Excel和日志文件名都会包含当前时间戳，确保每次运行的结果独立保存，便于版本管理和历史追溯。

### 5. 历史记录功能
- **独立的Excel历史文件**: 程序会在Python脚本所在目录下的“反推历史记录”文件夹中维护一个 `scan_history.xlsx` 文件。
- **记录内容**: 每次运行的统计信息（运行时间、分析目录、总文件量、成功匹配TXT数量、失败匹配TXT数量）都会追加到该历史文件中。

### 6. 自动打开结果
- **便捷性**: 程序运行完成后，会自动打开生成的Excel结果文件、日志文件，以及一份带有时间戳的 `scan_history.xlsx` 缓存副本（保存在 `C:\个人数据\pythonCode\反推图片信息\cache` 目录下，如果文件夹不存在会自动创建），方便用户立即查看结果。
- **跨平台兼容**: 支持在Windows、macOS和Linux/Unix系统上自动打开文件。

## 如何使用

1.  **运行脚本**: 运行 `InterrogateText2Xlsx3.0.py`。
2.  **输入文件夹路径**: 程序会提示您输入要处理的文件夹的绝对路径。
3.  **查看结果**: 程序运行完成后，会自动打开生成的Excel报告、日志文件和历史记录文件。

## 注意事项

-   确保您输入的文件夹路径是有效的且具有读取权限。
-   程序会在Python脚本所在目录和目标文件夹下创建新的文件夹和文件，请确保相应的写入权限。
-   日志文件会记录程序的详细运行情况和任何错误信息，建议检查日志文件以排除问题。
-   本版本 (v3.0) 扩展了R18关键词库，新增“黑白原图”提示词类型，并增加了Tag词频统计功能，提升了数据分析维度。